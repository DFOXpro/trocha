/** @license trocha@0.2.0 - 2019-03-17
* Trocha.js 
* 
* This source code is licensed under the Mozillas Public license 2.0 found in the 
* LICENSE file in the root directory of this source tree. 
*/

function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=_superPropBase(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},i=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),i.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classPrivateFieldGet(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var r=t.get(e);return r.get?r.get.call(e):r.value}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var r="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,r){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&_setPrototypeOf(n,r.prototype),n}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}!function(e){var p=function(e,t,r){throw new(function(e){function n(e,t,r){var i;return _classCallCheck(this,n),(i=_possibleConstructorReturn(this,_getPrototypeOf(n).call(this,a+t))).scope=e,i.value=r,i}return _inherits(n,_wrapNativeSuper(Error)),n}())(e,t,r)},n=function(e,t,r){console.warn(i+t,r||d,e||d)},d="",v="ROUTE",_="SCOPE",h="RESOURCE",y="ALIAS",P="id",g="name",F="hide",G="type",b="alias",O="query",S="post",w="method",k="domain",C="justId",E="fragment",m="resource",R="parentId",T="defaultId",j="alwaysUrl",A="alwaysPost",U="path",r="list",N=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"$",t={};return t[e+P]=P,t.show={},t.edit={},t.new={},t[r]={},t.show[e+F]=!0,t.new[e+P]=!1,t[r][e+P]=!1,t[r][e+F]=!0,t},a="TrochaJS error: ",i="TrochaJS warning: ",Route=function(){function Route(e,t,r,i){var n=this,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},o=5<arguments.length?arguments[5]:void 0,l=6<arguments.length?arguments[6]:void 0,s=7<arguments.length?arguments[7]:void 0,c=8<arguments.length?arguments[8]:void 0,u=9<arguments.length?arguments[9]:void 0;_classCallCheck(this,Route),D.set(this,{writable:!0,value:{parent:null,childs:{},SS:"$",alwaysPost:!1,alwaysUrl:!1,domain:"",post:"",pre:""}}),I.set(this,{writable:!0,value:function(e,t){var r=_classPrivateFieldGet(e,D).SS;return!!_classPrivateFieldGet(e,D).parent&&(_classPrivateFieldGet(e,D).parent[r+P]===t||_classPrivateFieldGet(e,I).call(e,_classPrivateFieldGet(e,D).parent,t))}}),M.set(this,{writable:!0,value:function(e,t,r,i){var n=i?"":_classPrivateFieldGet(e,D).SS;Object.defineProperty(e,n+t,{get:function(){return r?r():_classPrivateFieldGet(e,D)[t]},enumerable:!0,configurable:!1})}}),H.set(this,{writable:!0,value:function(t,r){var i=_classPrivateFieldGet(t,D).SS,e=function(e){_classPrivateFieldGet(t,D)[e]=r[i+e],delete r[i+e]};e(g),e(P),e(T),e(G),e(w),e(b),e(m),e(F),e(S),e(C),e(R),!1===r[_classPrivateFieldGet(t,D).parent[i+P]]&&e(_classPrivateFieldGet(t,D).parent[i+P]),_classPrivateFieldGet(t,M).call(t,t,g),_classPrivateFieldGet(t,M).call(t,t,P),_classPrivateFieldGet(t,M).call(t,t,w),_classPrivateFieldGet(t,M).call(t,t,"as",function(){return _classPrivateFieldGet(t,x).call(t,t)})}}),L.set(this,{writable:!0,value:function(e,t,r){var i=_classPrivateFieldGet(e,D).SS;_classPrivateFieldGet(e,D).childs[r]&&p(e,"Route already declare",r),[Route,Alias,Resource,Scope].forEach(function(e){e.is(t,i)&&(t=e.diggest(t,i,i))}),t[i+g]=r;var n={};n[v]=Route,n[void 0]=Route,n[y]=Alias,n[_]=Scope,n[h]=Resource;var a=new n[t[i+G]](e,t,i,_classPrivateFieldGet(e,D).root);_classPrivateFieldGet(e,D).childs[r]=a,_classPrivateFieldGet(e,M).call(e,e,r,function(){return _classPrivateFieldGet(e,D).childs[r]},!0)}}),W.set(this,{writable:!0,value:function(e,t,r){var i=_classPrivateFieldGet(e,D).SS;if(!r&&_classPrivateFieldGet(e,D)[G]===h){var n=_classPrivateFieldGet(e,D)[m];delete n[i+P],_classPrivateFieldGet(e,W).call(e,e,n,!0)}for(var a=Object.keys(t);a.length;){var o=a.pop();if(!1===t[o]&&_classPrivateFieldGet(e,I).call(e,e,o))_classPrivateFieldGet(e,D)[o]=!1;else if(_classPrivateFieldGet(e,L).call(e,e,t[o],o),_classPrivateFieldGet(e,D)[G]===_){var l=_objectSpread({},t[o]);l[i+R]=!1,_classPrivateFieldGet(e,L).call(e,_classPrivateFieldGet(e,D).parent,l,o)}}}}),x.set(this,{writable:!0,value:function(e){var t=_classPrivateFieldGet(e,D).SS;return _classPrivateFieldGet(e,D).parent[t+"as"]?"".concat(_classPrivateFieldGet(e,D).parent[t+"as"],"_").concat(_classPrivateFieldGet(e,D)[g]):_classPrivateFieldGet(e,D)[g]}}),_defineProperty(this,"_newRoute",function(e){if(e[G]=v,!Route.is(e,""))return!1;_classPrivateFieldGet(n,L).call(n,n,Route.diggest(e,_classPrivateFieldGet(n,D).SS,""),e[g])}),_defineProperty(this,"_newScope",function(e){if(e[G]=_,!Scope.is(e,""))return!1;_classPrivateFieldGet(n,L).call(n,n,Scope.diggest(e,_classPrivateFieldGet(n,D).SS,""),e[g])}),_defineProperty(this,"_newAlias",function(e){if(e[G]=y,!Alias.is(e,""))return!1;_classPrivateFieldGet(n,L).call(n,n,Alias.diggest(e,_classPrivateFieldGet(n,D).SS,""),e[g])}),_defineProperty(this,"_newResource",function(e){if(e[G]=h,!Resource.is(e,""))return!1;_classPrivateFieldGet(n,L).call(n,n,Resource.diggest(e,_classPrivateFieldGet(n,D).SS,""),e[g])}),_defineProperty(this,"toString",function(){return _classPrivateFieldGet(n,x).call(n,n)});var f=_classPrivateFieldGet(this,D).SS=r||"$";e||t&&t[f+g]&&t[f+G]?(_classPrivateFieldGet(this,D).parent=e,_classPrivateFieldGet(this,D).root=i,_classPrivateFieldGet(this,H).call(this,this,t),_classPrivateFieldGet(this,W).call(this,this,t)):(_classPrivateFieldGet(this,D)[k]=o||_classPrivateFieldGet(this,D)[k],_classPrivateFieldGet(this,M).call(this,this,k),_classPrivateFieldGet(this,D)[j]=l||_classPrivateFieldGet(this,D)[j],_classPrivateFieldGet(this,D)[A]=u||_classPrivateFieldGet(this,D)[A],_classPrivateFieldGet(this,D)[S]=c||_classPrivateFieldGet(this,D)[S],_classPrivateFieldGet(this,D).pre=s||_classPrivateFieldGet(this,D).pre,_classPrivateFieldGet(this,D).root=_classPrivateFieldGet(this,D),delete this[U],_classPrivateFieldGet(this,M).call(this,this,h,function(){return N(f)}),_classPrivateFieldGet(this,W).call(this,this,a))}return _createClass(Route,[{key:"path",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length?arguments[1]:void 0,r=_classPrivateFieldGet(this,D),i=r.parent||{},n=r.root,a=r.SS,o=d;if(void 0===r[g])return"";o=n[k]&&!1!==t.url&&(t.url||n[j])?n[k]:d,delete t.url,o+=n.pre&&(t.pre||t.ext)?n.pre:d,delete t.pre,o+=i[U]?i[U]({post:!1},function(){return!0}):d;var l,s=void 0!==t[F]?t[F]:r[F]||r[C]&&!1===r[T];if("function"==typeof e&&(l=e(r)),"string"==typeof l)o+=l;else{var c=":"+r.id;if(!1!==t[C]&&r[C]&&r.id&&!1!==r[r.id])o+="/"+c;else{var u=!r.id||!1===t.id;o+=s?d:"/"+r[g],o+=u?d:"/"+c}}o+=n[S]&&!s&&!1!==t[S]&&(n[A]||r[S]||t[S]||t.ext)?n[S]:d,delete t[S];var f={};t[O]&&(f=JSON.parse(JSON.stringify(t[O])),delete t[O]);var p=d;return t[E]&&(p=t[E],delete t[E]),!i[a+P]||t[i[a+P]]||!1!==r.id&&!1!==t[R]&&!1!==r[R]||(o=o.replace("/:"+i[a+P],d)),Object.keys(r).forEach(function(e){if(!1===r[e]&&!t[e])return o=o.replace("/:"+e,d)}),Object.keys(t).forEach(function(e){o=!1===t[e]?o.replace("/:"+e,d):o.replace(":"+e,t[e])}),Object.keys(f).forEach(function(r,i,n){0===i&&(o+="?"),Array.isArray(f[r])?f[r].forEach(function(e,t){return o+=encodeURIComponent(r)+"[]="+encodeURIComponent(e)+(f[r].length-1!==t||n.length-1!==i?"&":"")}):o+=encodeURIComponent(r)+"="+encodeURIComponent(f[r])+(n.length-1!==i?"&":"")}),p&&(o+="#"+encodeURIComponent(p)),o}}],[{key:"is",value:function(e,t){return e[t+G]===v||"object"===_typeof(e)&&void 0===e[t+G]}}]),Route}(),D=new WeakMap,I=new WeakMap,M=new WeakMap,H=new WeakMap,L=new WeakMap,W=new WeakMap,x=new WeakMap;_defineProperty(Route,"DEFAULT_METHOD","GET"),_defineProperty(Route,"diggest",function(t,r,i,n,e){if(!n||!e){var a={};return a[r+G]=v,a[r+w]=t[i+w]||Route.DEFAULT_METHOD,Route.diggest(t,r,i,a,[P,F,C,S,R]),Route._trimSelector(i,t,a),a}e.forEach(function(e){n[r+e]=t[i+e]})}),_defineProperty(Route,"_trimSelector",function(t,r,i){Object.keys(r).forEach(function(e){e.slice(0,2)!==t?i[e]=r[e]:n(Route,"Attribute not supported, skiped",e)})});var Alias=function(e){function Alias(){var e;_classCallCheck(this,Alias);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return _possibleConstructorReturn(this,(e=_getPrototypeOf(Alias)).call.apply(e,[this].concat(r)))}return _inherits(Alias,Route),_createClass(Alias,[{key:"path",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _get(_getPrototypeOf(Alias.prototype),"path",this).call(this,a,function(e){var t=d,r="/:"+e.id,i=e.parent||{};if(e.root,e.id&&a[C])t+=r;else{var n=!!e.id&&!1!==a[e.id];t+="Trocha"===i.constructor.name?d:"/",t+=a[F]?d:e[b],t+=n?r:d}return t})}}],[{key:"diggest",value:function(e,t,r){var i={};return i[t+G]=y,i[t+b]=e[r+b]||e,i[t+w]=e[r+w]||Route.DEFAULT_METHOD,Route.diggest(e,t,r,i,[P,S,R]),"string"!=typeof e&&Route._trimSelector(r,e,i),i}},{key:"is",value:function(e,t){return"string"==typeof e||e[t+G]===y&&e[t+b]}}]),Alias}(),Resource=function(e){function Resource(){var e;_classCallCheck(this,Resource);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return _possibleConstructorReturn(this,(e=_getPrototypeOf(Resource)).call.apply(e,[this].concat(r)))}return _inherits(Resource,Route),_createClass(Resource,[{key:"path",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;return _get(_getPrototypeOf(Resource.prototype),"path",this).call(this,e,function(e){return"function"==typeof t&&!0!==t()&&n(void 0,"Resource should not be used as a route"),!1})}}],[{key:"diggest",value:function(e,t,r){var i={};return i[t+G]=h,i[t+m]=e[r+m]||N(t),Route.diggest(e,t,r,i,[P]),Route._trimSelector(r,e,i),i}},{key:"is",value:function(e,t){return e[t+G]===h&&e[t+P]}}]),Resource}(),Scope=function(e){function Scope(){var e;_classCallCheck(this,Scope);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return _possibleConstructorReturn(this,(e=_getPrototypeOf(Scope)).call.apply(e,[this].concat(r)))}return _inherits(Scope,Route),_createClass(Scope,[{key:"path",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;return _get(_getPrototypeOf(Scope.prototype),"path",this).call(this,e,function(e){return"function"==typeof t&&!0!==t()&&p(void 0,"Scope is not printable a route"),!1})}}],[{key:"diggest",value:function(e,t,r){var i={};return i[t+G]=_,i[t+C]=!0,i[t+T]=e[r+T]||!1,Route.diggest(e,t,r,i,[P,F]),Route._trimSelector(r,e,i),i}},{key:"is",value:function(e,t){return"object"===_typeof(e)&&e[t+G]===_&&e[t+P]}}]),Scope}(),Trocha=function(e){function Trocha(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,Trocha),_possibleConstructorReturn(this,_getPrototypeOf(Trocha).call(this,null,null,e.customSelector,null,e.routes,e.domain,e.alwaysUrl,e.pre,e.post,e.alwaysPost))}return _inherits(Trocha,Route),_createClass(Trocha,null,[{key:"ROUTE",get:function(){return v}},{key:"SCOPE",get:function(){return _}},{key:"RESOURCE",get:function(){return h}},{key:"ALIAS",get:function(){return y}},{key:"OPTIONS",get:function(){return"OPTIONS"}},{key:"GET",get:function(){return"GET"}},{key:"HEAD",get:function(){return"HEAD"}},{key:"POST",get:function(){return"POST"}},{key:"PUT",get:function(){return"PUT"}},{key:"PATCH",get:function(){return"PATCH"}},{key:"DELETE",get:function(){return"DELETE"}},{key:"TRACE",get:function(){return"TRACE"}},{key:"CONNECT",get:function(){return"CONNECT"}},{key:"$RESOURCE",get:function(){return N()}}]),Trocha}();self.Trocha=Trocha,e.Trocha=Trocha}(this);