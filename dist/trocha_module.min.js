/** @license trocha@0.2.1 - 2019-04-10
* Trocha.js 
* 
* This source code is licensed under the Mozillas Public license 2.0 found in the 
* LICENSE file in the root directory of this source tree. 
*/

"use strict";function _get(e,t,r){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=_superPropBase(e,t);if(n){var a=Object.getOwnPropertyDescriptor(n,t);return a.get?a.get.call(r):a.value}})(e,t,r||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){_defineProperty(t,e,r[e])})}return t}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classPrivateFieldGet(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");var r=t.get(e);return r.get?r.get.call(e):r.value}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var r="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(t,e)})(e)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,r){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return r&&_setPrototypeOf(a,r.prototype),a}).apply(null,arguments)}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.$RESOURCE=exports.ALIAS=exports.RESOURCE=exports.SCOPE=exports.ROUTE=exports.CONNECT=exports.TRACE=exports.DELETE=exports.PATCH=exports.PUT=exports.POST=exports.HEAD=exports.GET=exports.OPTIONS=exports.Scope=exports.Resource=exports.Alias=exports.Route=exports.Trocha=void 0;var _throwError=function(e,t,r){throw new(function(e){function a(e,t,r){var n;return _classCallCheck(this,a),(n=_possibleConstructorReturn(this,_getPrototypeOf(a).call(this,ERROR_HEADER+t))).scope=e,n.value=r,n}return _inherits(a,_wrapNativeSuper(Error)),a}())(e,t,r)},_throwWarning=function(e,t,r){console.warn(WARNING_HEADER+t,r||s,e||s)},s="",_="/",DS="$",OPTIONS="OPTIONS";exports.OPTIONS=OPTIONS;var GET="GET";exports.GET=GET;var HEAD="HEAD";exports.HEAD=HEAD;var POST="POST";exports.POST=POST;var PUT="PUT";exports.PUT=PUT;var PATCH="PATCH";exports.PATCH=PATCH;var DELETE="DELETE";exports.DELETE=DELETE;var TRACE="TRACE";exports.TRACE=TRACE;var CONNECT="CONNECT";exports.CONNECT=CONNECT;var ROUTE="ROUTE";exports.ROUTE=ROUTE;var SCOPE="SCOPE";exports.SCOPE=SCOPE;var _RESOURCE="RESOURCE";exports.RESOURCE=_RESOURCE;var _ALIAS="ALIAS";exports.ALIAS=_ALIAS;var COLON="COLON",BRACKETS="BRACKETS",_ID_MODE_REPLACE="Ã‘",_PREID=_+_ID_MODE_REPLACE,_AVAILABLE_ID_MODES={};_AVAILABLE_ID_MODES[BRACKETS]="{".concat(_ID_MODE_REPLACE,"}"),_AVAILABLE_ID_MODES[COLON]=":".concat(_ID_MODE_REPLACE);var _FORMAT_ID_FUN=function(t){return function(e){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:_ID_MODE_REPLACE).replace(_ID_MODE_REPLACE,_AVAILABLE_ID_MODES[t].replace(_ID_MODE_REPLACE,e))}},ID="id",URL="url",NAME="name",HIDE="hide",TYPE="type",PREFIX="pre",ALIAS="alias",QUERY="query",POSTFIX="post",EXTENDED="ext",METHOD="method",DOMAIN="domain",ROUTES="routes",ID_MODE="idMode",JUST_ID="justId",FRAGMENT="fragment",RESOURCE="resource",PARENT_ID="parentId",DEFAULT_ID="defaultId",ALWAYS_URL="alwaysUrl",ALWAYS_POST="alwaysPost",CUSTOM_SELECTOR="customSelector",AS="as",PATH="path",_show="show",_edit="edit",_new="new",_list="list",_basicResource=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:DS,t={};return t[e+ID]=ID,t[_show]={},t[_edit]={},t[_new]={},t[_list]={},t[_show][e+HIDE]=!0,t[_new][e+ID]=!1,t[_list][e+ID]=!1,t[_list][e+HIDE]=!0,t};exports.$RESOURCE=_basicResource;var ERROR_HEADER="TrochaJS error: ",WARNING_HEADER="TrochaJS warning: ",ERROR_ROUTE_ALREADY_DEFINE="Route already declare",ERROR_SCOPE_AS_A_ROUTE="Scope is not printable a route",WARNING_RESOURCE_AS_A_ROUTE="Resource should not be used as a route",WARNING_ROUTE_ATTRIBUTE_NOT_SUPPORTED="Attribute not supported, skiped",Route=function(){function Route(e,t,r,n){var a=this,i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},o=5<arguments.length?arguments[5]:void 0,s=6<arguments.length?arguments[6]:void 0,l=7<arguments.length?arguments[7]:void 0,c=8<arguments.length?arguments[8]:void 0,_=9<arguments.length?arguments[9]:void 0,u=10<arguments.length?arguments[10]:void 0;_classCallCheck(this,Route),_data.set(this,{writable:!0,value:{parent:null,childs:{},SS:DS,alwaysPost:!1,alwaysUrl:!1,idMode:COLON,domain:"",post:"",pre:""}}),_anyParentHasThisId.set(this,{writable:!0,value:function(e,t){var r=_classPrivateFieldGet(e,_data).SS;return!!_classPrivateFieldGet(e,_data).parent&&(_classPrivateFieldGet(e,_data).parent[r+ID]===t||_classPrivateFieldGet(e,_anyParentHasThisId).call(e,_classPrivateFieldGet(e,_data).parent,t))}}),_newGetter.set(this,{writable:!0,value:function(e,t,r,n){var a=n?"":_classPrivateFieldGet(e,_data).SS;Object.defineProperty(e,a+t,{get:function(){return r?r():_classPrivateFieldGet(e,_data)[t]},enumerable:!0,configurable:!1})}}),_defineMyAttributes.set(this,{writable:!0,value:function(t,r){var n=_classPrivateFieldGet(t,_data).SS,e=function(e){_classPrivateFieldGet(t,_data)[e]=r[n+e],delete r[n+e]};e(NAME),e(ID),e(DEFAULT_ID),e(TYPE),e(METHOD),e(ALIAS),e(RESOURCE),e(HIDE),e(POSTFIX),e(JUST_ID),e(PARENT_ID),!1===r[_classPrivateFieldGet(t,_data).parent[n+ID]]&&e(_classPrivateFieldGet(t,_data).parent[n+ID]),_classPrivateFieldGet(t,_newGetter).call(t,t,NAME),_classPrivateFieldGet(t,_newGetter).call(t,t,ID),_classPrivateFieldGet(t,_newGetter).call(t,t,METHOD),_classPrivateFieldGet(t,_newGetter).call(t,t,AS,function(){return _classPrivateFieldGet(t,_as).call(t,t)})}}),_createChildRoute.set(this,{writable:!0,value:function(e,t,r){var n=_classPrivateFieldGet(e,_data).SS;_classPrivateFieldGet(e,_data).childs[r]&&_throwError(e,ERROR_ROUTE_ALREADY_DEFINE,r),[Route,Alias,Resource,Scope].forEach(function(e){e.is(t,n)&&(t=e.diggest(t,n,n))}),t[n+NAME]=r;var a={};a[ROUTE]=Route,a[void 0]=Route,a[_ALIAS]=Alias,a[SCOPE]=Scope,a[_RESOURCE]=Resource;var i=new a[t[n+TYPE]](e,t,n,_classPrivateFieldGet(e,_data).root);_classPrivateFieldGet(e,_data).childs[r]=i,_classPrivateFieldGet(e,_newGetter).call(e,e,r,function(){return _classPrivateFieldGet(e,_data).childs[r]},!0)}}),_diggestChildRoutes.set(this,{writable:!0,value:function(e,t,r){var n=_classPrivateFieldGet(e,_data).SS;if(!r&&_classPrivateFieldGet(e,_data)[TYPE]===_RESOURCE){var a=_classPrivateFieldGet(e,_data)[RESOURCE];delete a[n+ID],_classPrivateFieldGet(e,_diggestChildRoutes).call(e,e,a,!0)}for(var i=Object.keys(t);i.length;){var o=i.pop();if(!1===t[o]&&_classPrivateFieldGet(e,_anyParentHasThisId).call(e,e,o))_classPrivateFieldGet(e,_data)[o]=!1;else if(_classPrivateFieldGet(e,_createChildRoute).call(e,e,t[o],o),_classPrivateFieldGet(e,_data)[TYPE]===SCOPE){var s=_objectSpread({},t[o]);s[n+PARENT_ID]=!1,_classPrivateFieldGet(e,_createChildRoute).call(e,_classPrivateFieldGet(e,_data).parent,s,o)}}}}),_as.set(this,{writable:!0,value:function(e){var t=_classPrivateFieldGet(e,_data).SS;return _classPrivateFieldGet(e,_data).parent[t+AS]?"".concat(_classPrivateFieldGet(e,_data).parent[t+AS],"_").concat(_classPrivateFieldGet(e,_data)[NAME]):_classPrivateFieldGet(e,_data)[NAME]}}),_defineProperty(this,"_newRoute",function(e){if(e[TYPE]=ROUTE,!Route.is(e,""))return!1;_classPrivateFieldGet(a,_createChildRoute).call(a,a,Route.diggest(e,_classPrivateFieldGet(a,_data).SS,""),e[NAME])}),_defineProperty(this,"_newScope",function(e){if(e[TYPE]=SCOPE,!Scope.is(e,""))return!1;_classPrivateFieldGet(a,_createChildRoute).call(a,a,Scope.diggest(e,_classPrivateFieldGet(a,_data).SS,""),e[NAME])}),_defineProperty(this,"_newAlias",function(e){if(e[TYPE]=_ALIAS,!Alias.is(e,""))return!1;_classPrivateFieldGet(a,_createChildRoute).call(a,a,Alias.diggest(e,_classPrivateFieldGet(a,_data).SS,""),e[NAME])}),_defineProperty(this,"_newResource",function(e){if(e[TYPE]=_RESOURCE,!Resource.is(e,""))return!1;_classPrivateFieldGet(a,_createChildRoute).call(a,a,Resource.diggest(e,_classPrivateFieldGet(a,_data).SS,""),e[NAME])}),_defineProperty(this,"toString",function(){return _classPrivateFieldGet(a,_as).call(a,a)});var E=_classPrivateFieldGet(this,_data).SS=r||DS;if(e||t&&t[E+NAME]&&t[E+TYPE])_classPrivateFieldGet(this,_data).parent=e,_classPrivateFieldGet(this,_data).root=n,_classPrivateFieldGet(this,_defineMyAttributes).call(this,this,t),_classPrivateFieldGet(this,_diggestChildRoutes).call(this,this,t);else{var f=function(e,t){return _classPrivateFieldGet(a,_data)[e]=t||_classPrivateFieldGet(a,_data)[e]};f(DOMAIN,o),_classPrivateFieldGet(this,_newGetter).call(this,this,DOMAIN),f(ALWAYS_URL,s),f(ALWAYS_POST,_),f(POSTFIX,c),f(PREFIX,l),f(ID_MODE,u),_classPrivateFieldGet(this,_data).root=_classPrivateFieldGet(this,_data),delete this[PATH],_classPrivateFieldGet(this,_newGetter).call(this,this,_RESOURCE,function(){return _basicResource(E)}),_classPrivateFieldGet(this,_diggestChildRoutes).call(this,this,i)}}return _createClass(Route,[{key:"path",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length?arguments[1]:void 0,r=_classPrivateFieldGet(this,_data),n=r.parent||{},a=r.root,i=r.SS,o=_FORMAT_ID_FUN(a[ID_MODE]),l=s;if(void 0===r[NAME])return"";l=a[DOMAIN]&&!1!==t[URL]&&(t[URL]||a[ALWAYS_URL])?a[DOMAIN]:s,delete t[URL],l+=a[PREFIX]&&(t[PREFIX]||t[EXTENDED])?a[PREFIX]:s,delete t[PREFIX];var c={};c[POSTFIX]=!1,l+=n[PATH]?n[PATH](c,function(){return!0}):s;var u,E=void 0!==t[HIDE]?t[HIDE]:r[HIDE]||r[JUST_ID]&&!1===r[DEFAULT_ID];if("function"==typeof e&&(u=e(r)),"string"==typeof u)l+=u;else{var f=o(r[ID]);if(!1!==t[JUST_ID]&&r[JUST_ID]&&r[ID]&&!1!==r[r[ID]])l+=_+f;else{var p=!r[ID]||!1===t[ID];l+=E?s:_+r[NAME],l+=p?s:_+f}}l+=a[POSTFIX]&&!E&&!1!==t[POSTFIX]&&(a[ALWAYS_POST]||r[POSTFIX]||t[POSTFIX]||t[EXTENDED])?a[POSTFIX]:s,delete t[POSTFIX];var d={};t[QUERY]&&(d=JSON.parse(JSON.stringify(t[QUERY])),delete t[QUERY]);var R=s;return t[FRAGMENT]&&(R=t[FRAGMENT],delete t[FRAGMENT]),!n[i+ID]||t[n[i+ID]]||!1!==r[ID]&&!1!==t[PARENT_ID]&&!1!==r[PARENT_ID]||(l=l.replace(o(n[i+ID],_PREID),s)),Object.keys(r).forEach(function(e){if(!1===r[e]&&!t[e])return l=l.replace(o(e,_PREID),s)}),Object.keys(t).forEach(function(e){l=!1===t[e]?l.replace(o(e,_PREID),s):l.replace(o(e),t[e])}),Object.keys(d).forEach(function(r,n,a){0===n&&(l+="?"),Array.isArray(d[r])?d[r].forEach(function(e,t){return l+=encodeURIComponent(r)+"[]="+encodeURIComponent(e)+(d[r].length-1!==t||a.length-1!==n?"&":"")}):l+=encodeURIComponent(r)+"="+encodeURIComponent(d[r])+(a.length-1!==n?"&":"")}),R&&(l+="#"+encodeURIComponent(R)),l}}],[{key:"is",value:function(e,t){return e[t+TYPE]===ROUTE||"object"===_typeof(e)&&void 0===e[t+TYPE]}}]),Route}();exports.Route=Route;var _data=new WeakMap,_anyParentHasThisId=new WeakMap,_newGetter=new WeakMap,_defineMyAttributes=new WeakMap,_createChildRoute=new WeakMap,_diggestChildRoutes=new WeakMap,_as=new WeakMap;_defineProperty(Route,"DEFAULT_METHOD",GET),_defineProperty(Route,"diggest",function(t,r,n,a,e){if(!a||!e){var i={};return i[r+TYPE]=ROUTE,i[r+METHOD]=t[n+METHOD]||Route.DEFAULT_METHOD,Route.diggest(t,r,n,i,[ID,HIDE,JUST_ID,POSTFIX,PARENT_ID]),Route._trimSelector(n,t,i),i}e.forEach(function(e){a[r+e]=t[n+e]})}),_defineProperty(Route,"_trimSelector",function(t,r,n){""!==t&&Object.keys(r).forEach(function(e){e.slice(0,2)!==t?n[e]=r[e]:_throwWarning(Route,WARNING_ROUTE_ATTRIBUTE_NOT_SUPPORTED,e)})});var Alias=function(e){function Alias(){var e;_classCallCheck(this,Alias);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return _possibleConstructorReturn(this,(e=_getPrototypeOf(Alias)).call.apply(e,[this].concat(r)))}return _inherits(Alias,Route),_createClass(Alias,[{key:"path",value:function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _get(_getPrototypeOf(Alias.prototype),"path",this).call(this,o,function(e){var t=e.parent||{},r=e.root,n=_FORMAT_ID_FUN(r[ID_MODE])(e[ID],_PREID),a=s;if(e[ID]&&o[JUST_ID])a+=n;else{var i=!!e[ID]&&!1!==o[e[ID]];a+="Trocha"===t.constructor.name?s:_,a+=o[HIDE]?s:e[ALIAS],a+=i?n:s}return a})}}],[{key:"diggest",value:function(e,t,r){var n={};return n[t+TYPE]=_ALIAS,n[t+ALIAS]=e[r+ALIAS]||e,n[t+METHOD]=e[r+METHOD]||Route.DEFAULT_METHOD,Route.diggest(e,t,r,n,[ID,POSTFIX,PARENT_ID]),"string"!=typeof e&&Route._trimSelector(r,e,n),n}},{key:"is",value:function(e,t){return"string"==typeof e||e[t+TYPE]===_ALIAS&&e[t+ALIAS]}}]),Alias}();exports.Alias=Alias;var Resource=function(e){function Resource(){var e;_classCallCheck(this,Resource);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return _possibleConstructorReturn(this,(e=_getPrototypeOf(Resource)).call.apply(e,[this].concat(r)))}return _inherits(Resource,Route),_createClass(Resource,[{key:"path",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;return _get(_getPrototypeOf(Resource.prototype),"path",this).call(this,e,function(e){return"function"==typeof t&&!0!==t()&&_throwWarning(void 0,WARNING_RESOURCE_AS_A_ROUTE),!1})}}],[{key:"diggest",value:function(e,t,r){var n={};return n[t+TYPE]=_RESOURCE,n[t+RESOURCE]=e[r+RESOURCE]||_basicResource(t),Route.diggest(e,t,r,n,[ID]),Route._trimSelector(r,e,n),n}},{key:"is",value:function(e,t){return e[t+TYPE]===_RESOURCE&&e[t+ID]}}]),Resource}();exports.Resource=Resource;var Scope=function(e){function Scope(){var e;_classCallCheck(this,Scope);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return _possibleConstructorReturn(this,(e=_getPrototypeOf(Scope)).call.apply(e,[this].concat(r)))}return _inherits(Scope,Route),_createClass(Scope,[{key:"path",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0;return _get(_getPrototypeOf(Scope.prototype),"path",this).call(this,e,function(e){return"function"==typeof t&&!0!==t()&&_throwError(void 0,ERROR_SCOPE_AS_A_ROUTE),!1})}}],[{key:"diggest",value:function(e,t,r){var n={};return n[t+TYPE]=SCOPE,n[t+JUST_ID]=!0,n[t+DEFAULT_ID]=e[r+DEFAULT_ID]||!1,Route.diggest(e,t,r,n,[ID,HIDE]),Route._trimSelector(r,e,n),n}},{key:"is",value:function(e,t){return"object"===_typeof(e)&&e[t+TYPE]===SCOPE&&e[t+ID]}}]),Scope}();exports.Scope=Scope;var Trocha=function(e){function Trocha(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,Trocha),_possibleConstructorReturn(this,_getPrototypeOf(Trocha).call(this,null,null,e[CUSTOM_SELECTOR],null,e[ROUTES],e[DOMAIN],e[ALWAYS_URL],e[PREFIX],e[POSTFIX],e[ALWAYS_POST],e[ID_MODE]))}return _inherits(Trocha,Route),_createClass(Trocha,null,[{key:"ROUTE",get:function(){return ROUTE}},{key:"SCOPE",get:function(){return SCOPE}},{key:"RESOURCE",get:function(){return _RESOURCE}},{key:"ALIAS",get:function(){return _ALIAS}},{key:"OPTIONS",get:function(){return OPTIONS}},{key:"GET",get:function(){return GET}},{key:"HEAD",get:function(){return HEAD}},{key:"POST",get:function(){return POST}},{key:"PUT",get:function(){return PUT}},{key:"PATCH",get:function(){return PATCH}},{key:"DELETE",get:function(){return DELETE}},{key:"TRACE",get:function(){return TRACE}},{key:"CONNECT",get:function(){return CONNECT}},{key:"BRACKETS",get:function(){return BRACKETS}},{key:"COLON",get:function(){return COLON}},{key:"$RESOURCE",get:function(){return _basicResource()}}]),Trocha}();exports.Trocha=Trocha;