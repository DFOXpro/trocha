/** @license TrochaJS@0.2.0 - 2019-03-13
* Trocha.js 
* 
* This source code is licensed under the Mozillas Public license 2.0 found in the 
* LICENSE file in the root directory of this source tree. 
*/
"use strict";function _typeof(a){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function _defineProperties(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{},d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classPrivateFieldGet(a,b){if(!b.has(a))throw new TypeError("attempted to get private field on non-instance");var c=b.get(a);return c.get?c.get.call(a):c.value}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){return!b||"object"!==_typeof(b)&&"function"!=typeof b?_assertThisInitialized(a):b}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _wrapNativeSuper(a){var b="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(a){function c(){return _construct(a,arguments,_getPrototypeOf(this).constructor)}if(null===a||!_isNativeFunction(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(c,a)})(a)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _construct(a,b,c){return _construct=isNativeReflectConstruct()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);var e=Function.bind.apply(a,d),f=new e;return c&&_setPrototypeOf(f,c.prototype),f},_construct.apply(null,arguments)}function _isNativeFunction(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function _setPrototypeOf(a,b){return(_setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function _getPrototypeOf(a){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.$RESOURCE=exports.ALIAS=exports.RESOURCE=exports.SCOPE=exports.ROUTE=exports.CONNECT=exports.TRACE=exports.DELETE=exports.PATCH=exports.PUT=exports.POST=exports.HEAD=exports.GET=exports.OPTIONS=exports.Route=exports.Trocha=void 0;var _throwError=function(a,b,c){var d=function(a){function b(a,c,d){var e;return _classCallCheck(this,b),e=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,ERROR_HEADER+c)),e.scope=a,e.value=d,e}return _inherits(b,a),b}(_wrapNativeSuper(Error));throw new d(a,b,c)},_="/",s="",DS="$",OPTIONS="OPTIONS";exports.OPTIONS=OPTIONS;var GET="GET";exports.GET=GET;var HEAD="HEAD";exports.HEAD=HEAD;var POST="POST";exports.POST=POST;var PUT="PUT";exports.PUT=PUT;var PATCH="PATCH";exports.PATCH=PATCH;var DELETE="DELETE";exports.DELETE=DELETE;var TRACE="TRACE";exports.TRACE=TRACE;var CONNECT="CONNECT";exports.CONNECT=CONNECT;var ROUTE="ROUTE";exports.ROUTE=ROUTE;var SCOPE="SCOPE";exports.SCOPE=SCOPE;var _RESOURCE="RESOURCE",_ALIAS="ALIAS";exports.ALIAS=_ALIAS;var ID="id",RESOURCE="resource";exports.RESOURCE=RESOURCE;var NAME="name",HIDE="hide",URL="url",TYPE="type",PREFIX="pre",ALIAS="alias",QUERY="query",FRAGMENT="fragment",POSTFIX="post",EXTENDED="ext",METHOD="method",DOMAIN="domain",ROUTES="routes",JUST_ID="justId",AFTER_ID="afterId",PARENT_ID="parentId",ALWAYS_URL="alwaysUrl",ALWAYS_POST="alwaysPost",CUSTOM_SELECTOR="customSelector",AS="as",PATH="path",_show="show",_edit="edit",_new="new",_list="list",_basicResource=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DS,b={};return b[a+ID]=ID,b[_show]={},b[_edit]={},b[_new]={},b[_list]={},b[_show][a+HIDE]=!0,b[_new][a+ID]=!1,b[_list][a+ID]=!1,b[_list][a+HIDE]=!0,b};exports.$RESOURCE=_basicResource;var ERROR_HEADER="TrochaJS error: ",ERROR_ROUTE_ALREADY_DEFINE="route already declare",Route=function a(b,c,d,e){var f=this,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},h=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,j=arguments.length>7?arguments[7]:void 0,k=arguments.length>8?arguments[8]:void 0,l=arguments.length>9?arguments[9]:void 0;_classCallCheck(this,a),_data.set(this,{writable:!0,value:{parent:null,childs:{},SS:DS,alwaysPost:!1,alwaysUrl:!1,domain:"",post:"",pre:""}}),_anyParentHasThisId.set(this,{writable:!0,value:function(a,b){var c=_classPrivateFieldGet(a,_data).SS;return!!_classPrivateFieldGet(a,_data).parent&&(_classPrivateFieldGet(a,_data).parent[c+ID]===b||_classPrivateFieldGet(a,_anyParentHasThisId).call(a,_classPrivateFieldGet(a,_data).parent,b))}}),_newGetter.set(this,{writable:!0,value:function(a,b,c,d){var e=d?"":_classPrivateFieldGet(a,_data).SS;Object.defineProperty(a,e+b,{get:function(){return c?c():_classPrivateFieldGet(a,_data)[b]},enumerable:!0,configurable:!1})}}),_defineMyAttributes.set(this,{writable:!0,value:function(a,b){var c=_classPrivateFieldGet(a,_data).SS,d=function(d){_classPrivateFieldGet(a,_data)[d]=b[c+d],delete b[c+d]};d(NAME),d(ALIAS),d(ID),d(METHOD),d(ALIAS),d(TYPE),d(HIDE),d(JUST_ID),d(PARENT_ID),!1===b[_classPrivateFieldGet(a,_data).parent[c+ID]]&&d(_classPrivateFieldGet(a,_data).parent[c+ID]),_classPrivateFieldGet(a,_newGetter).call(a,a,NAME),_classPrivateFieldGet(a,_newGetter).call(a,a,ID),_classPrivateFieldGet(a,_newGetter).call(a,a,METHOD),_classPrivateFieldGet(a,_newGetter).call(a,a,AS,function(){return _classPrivateFieldGet(a,_as).call(a,a)})}}),_createChildRoute.set(this,{writable:!0,value:function(b,c,d){if(_classPrivateFieldGet(b,_data).childs[d]&&_throwError(b,ERROR_ROUTE_ALREADY_DEFINE,d),"string"==typeof c){var e=c;c={},c[_classPrivateFieldGet(b,_data).SS+ALIAS]=e}c[_classPrivateFieldGet(b,_data).SS+NAME]=d;var f=new a(b,c,_classPrivateFieldGet(b,_data).SS,_classPrivateFieldGet(b,_data).root);_classPrivateFieldGet(b,_data).childs[d]=f,_classPrivateFieldGet(b,_newGetter).call(b,b,d,function(){return _classPrivateFieldGet(b,_data).childs[d]},!0)}}),_diggestChildRoutes.set(this,{writable:!0,value:function(a,b,c){if(!c&&_classPrivateFieldGet(a,_data)[TYPE]===_RESOURCE){var d=_classPrivateFieldGet(a,_data).SS,e=b[d+RESOURCE]||_basicResource(d);delete e[d+ID],_classPrivateFieldGet(a,_diggestChildRoutes).call(a,a,e,!0),delete b[d+RESOURCE]}for(var f=Object.keys(b);f.length;){var g=f.pop();b[g]===!1&&_classPrivateFieldGet(a,_anyParentHasThisId).call(a,a,g)?_classPrivateFieldGet(a,_data)[g]=!1:_classPrivateFieldGet(a,_createChildRoute).call(a,a,b[g],g)}}}),_as.set(this,{writable:!0,value:function(a){var b=_classPrivateFieldGet(a,_data).SS;return _classPrivateFieldGet(a,_data).parent[b+AS]?"".concat(_classPrivateFieldGet(a,_data).parent[b+AS],"_").concat(_classPrivateFieldGet(a,_data)[NAME]):_classPrivateFieldGet(a,_data)[NAME]}}),_defineProperty(this,"_newRoute",function(a){var b=_classPrivateFieldGet(f,_data).SS,c={};c[b+TYPE]=ROUTE,c[b+METHOD]=a[METHOD],c[b+ID]=a[ID],c[b+HIDE]=a[HIDE],c[b+JUST_ID]=a[JUST_ID],_classPrivateFieldGet(f,_createChildRoute).call(f,f,c,a[NAME])}),_defineProperty(this,"_newScope",function(a){var b=_classPrivateFieldGet(f,_data).SS,c={};c[b+TYPE]=SCOPE,c[b+ID]=a[ID],_classPrivateFieldGet(f,_createChildRoute).call(f,f,c,a[NAME])}),_defineProperty(this,"_newAlias",function(a){var b=_classPrivateFieldGet(f,_data).SS,c={};c[b+ALIAS]=a[ALIAS],c[b+TYPE]=_ALIAS,c[b+METHOD]=a[METHOD],_classPrivateFieldGet(f,_createChildRoute).call(f,f,c,a[NAME])}),_defineProperty(this,"_newResource",function(a){var b=_classPrivateFieldGet(f,_data).SS,c={};c[b+RESOURCE]=a[RESOURCE],c[b+TYPE]=_RESOURCE,c[b+ID]=a[ID],_classPrivateFieldGet(f,_createChildRoute).call(f,f,c,a[NAME])}),_defineProperty(this,"path",function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=_classPrivateFieldGet(f,_data),c=b.parent||{},d=b.root,e=b.SS,g=s;if(void 0===b[NAME])return"";if(b[ALIAS])return b[ALIAS];g=d[DOMAIN]&&!c[PATH]&&a[URL]!==!1&&(a[URL]||d[e+alwaysUrl])?d[DOMAIN]:s,delete a[URL],g+=d[PREFIX]&&(a[PREFIX]||a[EXTENDED])?d[PREFIX]:s,delete a[PREFIX];var h={};h[POSTFIX]=!1,g+=c[PATH]?c[PATH](h):s;var i=":"+b[ID],j=void 0!==a[HIDE]?a[HIDE]:b[HIDE];if(a[JUST_ID]!==!1&&b[JUST_ID]&&b[ID])g+=_+i;else{var k=!b[ID]||a[ID]===!1;g+=j?s:_+b[NAME],g+=k?s:_+i}g+=d[POSTFIX]&&!j&&a[POSTFIX]!==!1&&(d[ALWAYS_POST]||b[POSTFIX]||a[POSTFIX]||a[EXTENDED])?d[POSTFIX]:s,delete a[POSTFIX];var l={};a[QUERY]&&(l=JSON.parse(JSON.stringify(a[QUERY])),delete a[QUERY]);var m=s;a[FRAGMENT]&&(m=a[FRAGMENT],delete a[FRAGMENT]);var n="/:";return!c[e+ID]||a[c[e+ID]]||b[ID]!==!1&&a[PARENT_ID]!==!1&&b[PARENT_ID]!==!1||(g=g.replace(n+c[e+ID],s)),Object.keys(b).forEach(function(c){if(b[c]===!1&&!a[c])return g=g.replace(n+c,s)}),Object.keys(a).forEach(function(b){g=a[b]===!1?g.replace(n+b,s):g.replace(":"+b,a[b])}),Object.keys(l).forEach(function(a,b,c){0===b&&(g+="?"),g+=encodeURIComponent(a)+"="+encodeURIComponent(l[a])+(c.length-1!==b?"&":"")}),m&&(g+="#"+encodeURIComponent(m)),g}),_defineProperty(this,"toString",function(){return _classPrivateFieldGet(f,_as).call(f,f)});var m=_classPrivateFieldGet(this,_data).SS=d||DS,n={};n[m+METHOD]=GET,n[m+TYPE]=ROUTE;var o=_objectSpread({},n,c);b||o[m+NAME]&&o[m+METHOD]&&o[m+TYPE]?(_classPrivateFieldGet(this,_data).parent=b,_classPrivateFieldGet(this,_data).root=e,_classPrivateFieldGet(this,_defineMyAttributes).call(this,this,o),_classPrivateFieldGet(this,_diggestChildRoutes).call(this,this,o)):(_classPrivateFieldGet(this,_data)[DOMAIN]=h||_classPrivateFieldGet(this,_data)[DOMAIN],_classPrivateFieldGet(this,_newGetter).call(this,this,DOMAIN),_classPrivateFieldGet(this,_data)[ALWAYS_URL]=i||_classPrivateFieldGet(this,_data)[ALWAYS_URL],_classPrivateFieldGet(this,_data)[ALWAYS_POST]=l||_classPrivateFieldGet(this,_data)[ALWAYS_POST],_classPrivateFieldGet(this,_data)[POSTFIX]=k||_classPrivateFieldGet(this,_data)[POSTFIX],_classPrivateFieldGet(this,_data)[PREFIX]=j||_classPrivateFieldGet(this,_data)[PREFIX],_classPrivateFieldGet(this,_data).root=_classPrivateFieldGet(this,_data),_classPrivateFieldGet(this,_newGetter).call(this,this,_RESOURCE,function(){return _basicResource(m)}),_classPrivateFieldGet(this,_diggestChildRoutes).call(this,this,g))};exports.Route=Route;var _data=new WeakMap,_anyParentHasThisId=new WeakMap,_newGetter=new WeakMap,_defineMyAttributes=new WeakMap,_createChildRoute=new WeakMap,_diggestChildRoutes=new WeakMap,_as=new WeakMap,Trocha=function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,b),_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,null,null,a.customSelector,null,a.routes,a.domain,a.alwaysUrl,a.pre,a.post,a.alwaysPost))}return _inherits(b,a),_createClass(b,null,[{key:"ROUTE",get:function(){return ROUTE}},{key:"SCOPE",get:function(){return SCOPE}},{key:"RESOURCE",get:function(){return _RESOURCE}},{key:"ALIAS",get:function(){return _ALIAS}},{key:"OPTIONS",get:function(){return OPTIONS}},{key:"GET",get:function(){return GET}},{key:"HEAD",get:function(){return HEAD}},{key:"POST",get:function(){return POST}},{key:"PUT",get:function(){return PUT}},{key:"PATCH",get:function(){return PATCH}},{key:"DELETE",get:function(){return DELETE}},{key:"TRACE",get:function(){return TRACE}},{key:"CONNECT",get:function(){return CONNECT}},{key:"$RESOURCE",get:function(){return _basicResource()}}]),b}(Route);exports.Trocha=Trocha;