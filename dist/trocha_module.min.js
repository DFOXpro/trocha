/** @license TrochaJS@0.2.0 - 2019-03-16
* Trocha.js 
* 
* This source code is licensed under the Mozillas Public license 2.0 found in the 
* LICENSE file in the root directory of this source tree. 
*/
"use strict";function _get(a,b,c){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}})(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _typeof(a){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function _objectSpread(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{},d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){_defineProperty(a,b,c[b])})}return a}function _defineProperties(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classPrivateFieldGet(a,b){if(!b.has(a))throw new TypeError("attempted to get private field on non-instance");var c=b.get(a);return c.get?c.get.call(a):c.value}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){return!b||"object"!==_typeof(b)&&"function"!=typeof b?_assertThisInitialized(a):b}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _wrapNativeSuper(a){var b="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(a){function c(){return _construct(a,arguments,_getPrototypeOf(this).constructor)}if(null===a||!_isNativeFunction(a))return a;if("function"!=typeof a)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof b){if(b.has(a))return b.get(a);b.set(a,c)}return c.prototype=Object.create(a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(c,a)})(a)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _construct(a,b,c){return _construct=isNativeReflectConstruct()?Reflect.construct:function(a,b,c){var d=[null];d.push.apply(d,b);var e=Function.bind.apply(a,d),f=new e;return c&&_setPrototypeOf(f,c.prototype),f},_construct.apply(null,arguments)}function _isNativeFunction(a){return Function.toString.call(a).indexOf("[native code]")!==-1}function _setPrototypeOf(a,b){return(_setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a})(a,b)}function _getPrototypeOf(a){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)})(a)}function _IntanceMethodHelper(){throw new Error("not implemented")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.$RESOURCE=exports.ALIAS=exports.RESOURCE=exports.SCOPE=exports.ROUTE=exports.CONNECT=exports.TRACE=exports.DELETE=exports.PATCH=exports.PUT=exports.POST=exports.HEAD=exports.GET=exports.OPTIONS=exports.Route=exports.Trocha=void 0;var _throwError=function(a,b,c){var d=function(a){function b(a,c,d){var e;return _classCallCheck(this,b),e=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,ERROR_HEADER+c)),e.scope=a,e.value=d,e}return _inherits(b,a),b}(_wrapNativeSuper(Error));throw new d(a,b,c)},_throwWarning=function(a,b,c){},_="/",s="",DS="$",OPTIONS="OPTIONS";exports.OPTIONS=OPTIONS;var GET="GET";exports.GET=GET;var HEAD="HEAD";exports.HEAD=HEAD;var POST="POST";exports.POST=POST;var PUT="PUT";exports.PUT=PUT;var PATCH="PATCH";exports.PATCH=PATCH;var DELETE="DELETE";exports.DELETE=DELETE;var TRACE="TRACE";exports.TRACE=TRACE;var CONNECT="CONNECT";exports.CONNECT=CONNECT;var ROUTE="ROUTE";exports.ROUTE=ROUTE;var SCOPE="SCOPE";exports.SCOPE=SCOPE;var _RESOURCE="RESOURCE",_ALIAS="ALIAS";exports.ALIAS=_ALIAS;var ID="id",URL="url",NAME="name",HIDE="hide",TYPE="type",PREFIX="pre",ALIAS="alias",QUERY="query",POSTFIX="post",EXTENDED="ext",METHOD="method",DOMAIN="domain",ROUTES="routes",JUST_ID="justId",FRAGMENT="fragment",RESOURCE="resource";exports.RESOURCE=RESOURCE;var PARENT_ID="parentId",DEFAULT_ID="defaultId",ALWAYS_URL="alwaysUrl",ALWAYS_POST="alwaysPost",CUSTOM_SELECTOR="customSelector",AS="as",PATH="path",_show="show",_edit="edit",_new="new",_list="list",_basicResource=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:DS,b={};return b[a+ID]=ID,b[_show]={},b[_edit]={},b[_new]={},b[_list]={},b[_show][a+HIDE]=!0,b[_new][a+ID]=!1,b[_list][a+ID]=!1,b[_list][a+HIDE]=!0,b};exports.$RESOURCE=_basicResource;var ERROR_HEADER="TrochaJS error: ",WARNING_HEADER="TrochaJS warning: ",ERROR_ROUTE_ALREADY_DEFINE="Route already declare",ERROR_SCOPE_AS_A_ROUTE="Scope is not printable a route",WARNING_RESOURCE_AS_A_ROUTE="Resource should not be used as a route",WARNING_ROUTE_ATTRIBUTE_NOT_SUPPORTED="Attribute not supported, skiped",Route=function(){function a(b,c,d,e){var f=this,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},h=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0,j=arguments.length>7?arguments[7]:void 0,k=arguments.length>8?arguments[8]:void 0,l=arguments.length>9?arguments[9]:void 0;_classCallCheck(this,a),_data.set(this,{writable:!0,value:{parent:null,childs:{},SS:DS,alwaysPost:!1,alwaysUrl:!1,domain:"",post:"",pre:""}}),_anyParentHasThisId.set(this,{writable:!0,value:function(a,b){var c=_classPrivateFieldGet(a,_data).SS;return!!_classPrivateFieldGet(a,_data).parent&&(_classPrivateFieldGet(a,_data).parent[c+ID]===b||_classPrivateFieldGet(a,_anyParentHasThisId).call(a,_classPrivateFieldGet(a,_data).parent,b))}}),_newGetter.set(this,{writable:!0,value:function(a,b,c,d){var e=d?"":_classPrivateFieldGet(a,_data).SS;Object.defineProperty(a,e+b,{get:function(){return c?c():_classPrivateFieldGet(a,_data)[b]},enumerable:!0,configurable:!1})}}),_defineMyAttributes.set(this,{writable:!0,value:function(a,b){var c=_classPrivateFieldGet(a,_data).SS,d=function(d){_classPrivateFieldGet(a,_data)[d]=b[c+d],delete b[c+d]};d(NAME),d(ID),d(DEFAULT_ID),d(TYPE),d(METHOD),d(ALIAS),d(RESOURCE),d(HIDE),d(POSTFIX),d(JUST_ID),d(PARENT_ID),!1===b[_classPrivateFieldGet(a,_data).parent[c+ID]]&&d(_classPrivateFieldGet(a,_data).parent[c+ID]),_classPrivateFieldGet(a,_newGetter).call(a,a,NAME),_classPrivateFieldGet(a,_newGetter).call(a,a,ID),_classPrivateFieldGet(a,_newGetter).call(a,a,METHOD),_classPrivateFieldGet(a,_newGetter).call(a,a,AS,function(){return _classPrivateFieldGet(a,_as).call(a,a)})}}),_createChildRoute.set(this,{writable:!0,value:function(b,c,d){var e=_classPrivateFieldGet(b,_data).SS;_classPrivateFieldGet(b,_data).childs[d]&&_throwError(b,ERROR_ROUTE_ALREADY_DEFINE,d);var f=[a,Alias,Resource,Scope];f.forEach(function(a){a.is(c,e)&&(c=a.diggest(c,e,e))}),c[e+NAME]=d;var g={};g[ROUTE]=a,g[void 0]=a,g[_ALIAS]=Alias,g[SCOPE]=Scope,g[_RESOURCE]=Resource;var h=new g[c[e+TYPE]](b,c,e,_classPrivateFieldGet(b,_data).root);_classPrivateFieldGet(b,_data).childs[d]=h,_classPrivateFieldGet(b,_newGetter).call(b,b,d,function(){return _classPrivateFieldGet(b,_data).childs[d]},!0)}}),_diggestChildRoutes.set(this,{writable:!0,value:function(a,b,c){var d=_classPrivateFieldGet(a,_data).SS;if(!c&&_classPrivateFieldGet(a,_data)[TYPE]===_RESOURCE){var e=_classPrivateFieldGet(a,_data)[RESOURCE];delete e[d+ID],_classPrivateFieldGet(a,_diggestChildRoutes).call(a,a,e,!0)}for(var f=Object.keys(b);f.length;){var g=f.pop();if(b[g]===!1&&_classPrivateFieldGet(a,_anyParentHasThisId).call(a,a,g))_classPrivateFieldGet(a,_data)[g]=!1;else if(_classPrivateFieldGet(a,_createChildRoute).call(a,a,b[g],g),_classPrivateFieldGet(a,_data)[TYPE]===SCOPE){var h=_objectSpread({},b[g]);h[d+PARENT_ID]=!1,_classPrivateFieldGet(a,_createChildRoute).call(a,_classPrivateFieldGet(a,_data).parent,h,g)}}}}),_as.set(this,{writable:!0,value:function(a){var b=_classPrivateFieldGet(a,_data).SS;return _classPrivateFieldGet(a,_data).parent[b+AS]?"".concat(_classPrivateFieldGet(a,_data).parent[b+AS],"_").concat(_classPrivateFieldGet(a,_data)[NAME]):_classPrivateFieldGet(a,_data)[NAME]}}),_defineProperty(this,"_newRoute",function(b){return b[TYPE]=ROUTE,!!a.is(b,"")&&void _classPrivateFieldGet(f,_createChildRoute).call(f,f,a.diggest(b,_classPrivateFieldGet(f,_data).SS,""),b[NAME])}),_defineProperty(this,"_newScope",function(a){return a[TYPE]=SCOPE,!!Scope.is(a,"")&&void _classPrivateFieldGet(f,_createChildRoute).call(f,f,Scope.diggest(a,_classPrivateFieldGet(f,_data).SS,""),a[NAME])}),_defineProperty(this,"_newAlias",function(a){return a[TYPE]=_ALIAS,!!Alias.is(a,"")&&void _classPrivateFieldGet(f,_createChildRoute).call(f,f,Alias.diggest(a,_classPrivateFieldGet(f,_data).SS,""),a[NAME])}),_defineProperty(this,"_newResource",function(a){return a[TYPE]=_RESOURCE,!!Resource.is(a,"")&&void _classPrivateFieldGet(f,_createChildRoute).call(f,f,Resource.diggest(a,_classPrivateFieldGet(f,_data).SS,""),a[NAME])}),_defineProperty(this,"toString",function(){return _classPrivateFieldGet(f,_as).call(f,f)});var m=_classPrivateFieldGet(this,_data).SS=d||DS;b||c&&c[m+NAME]&&c[m+TYPE]?(_classPrivateFieldGet(this,_data).parent=b,_classPrivateFieldGet(this,_data).root=e,_classPrivateFieldGet(this,_defineMyAttributes).call(this,this,c),_classPrivateFieldGet(this,_diggestChildRoutes).call(this,this,c)):(_classPrivateFieldGet(this,_data)[DOMAIN]=h||_classPrivateFieldGet(this,_data)[DOMAIN],_classPrivateFieldGet(this,_newGetter).call(this,this,DOMAIN),_classPrivateFieldGet(this,_data)[ALWAYS_URL]=i||_classPrivateFieldGet(this,_data)[ALWAYS_URL],_classPrivateFieldGet(this,_data)[ALWAYS_POST]=l||_classPrivateFieldGet(this,_data)[ALWAYS_POST],_classPrivateFieldGet(this,_data)[POSTFIX]=k||_classPrivateFieldGet(this,_data)[POSTFIX],_classPrivateFieldGet(this,_data)[PREFIX]=j||_classPrivateFieldGet(this,_data)[PREFIX],_classPrivateFieldGet(this,_data).root=_classPrivateFieldGet(this,_data),delete this[PATH],_classPrivateFieldGet(this,_newGetter).call(this,this,_RESOURCE,function(){return _basicResource(m)}),_classPrivateFieldGet(this,_diggestChildRoutes).call(this,this,g))}return _createClass(a,[{key:"path",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0,c=_classPrivateFieldGet(this,_data),d=c.parent||{},e=c.root,f=c.SS,g=s;if(void 0===c[NAME])return"";g=e[DOMAIN]&&a[URL]!==!1&&(a[URL]||e[ALWAYS_URL])?e[DOMAIN]:s,delete a[URL],g+=e[PREFIX]&&(a[PREFIX]||a[EXTENDED])?e[PREFIX]:s,delete a[PREFIX];var h={};h[POSTFIX]=!1,g+=d[PATH]?d[PATH](h,function(){return!0}):s;var i,j=void 0!==a[HIDE]?a[HIDE]:c[HIDE]||c[JUST_ID]&&c[DEFAULT_ID]===!1;if("function"==typeof b&&(i=b(c)),"string"==typeof i)g+=i;else{var k=":"+c[ID];if(a[JUST_ID]!==!1&&c[JUST_ID]&&c[ID]&&c[c[ID]]!==!1)g+=_+k;else{var l=!c[ID]||a[ID]===!1;g+=j?s:_+c[NAME],g+=l?s:_+k}}g+=e[POSTFIX]&&!j&&a[POSTFIX]!==!1&&(e[ALWAYS_POST]||c[POSTFIX]||a[POSTFIX]||a[EXTENDED])?e[POSTFIX]:s,delete a[POSTFIX];var m={};a[QUERY]&&(m=JSON.parse(JSON.stringify(a[QUERY])),delete a[QUERY]);var n=s;a[FRAGMENT]&&(n=a[FRAGMENT],delete a[FRAGMENT]);var o="/:";return!d[f+ID]||a[d[f+ID]]||c[ID]!==!1&&a[PARENT_ID]!==!1&&c[PARENT_ID]!==!1||(g=g.replace(o+d[f+ID],s)),Object.keys(c).forEach(function(b){if(c[b]===!1&&!a[b])return g=g.replace(o+b,s)}),Object.keys(a).forEach(function(b){g=a[b]===!1?g.replace(o+b,s):g.replace(":"+b,a[b])}),Object.keys(m).forEach(function(a,b,c){0===b&&(g+="?"),Array.isArray(m[a])?m[a].forEach(function(d,e){return g+=encodeURIComponent(a)+"[]="+encodeURIComponent(d)+(m[a].length-1!==e||c.length-1!==b?"&":"")}):g+=encodeURIComponent(a)+"="+encodeURIComponent(m[a])+(c.length-1!==b?"&":"")}),n&&(g+="#"+encodeURIComponent(n)),g}}],[{key:"is",value:function(a,b){return a[b+TYPE]===ROUTE||"object"===_typeof(a)&&void 0===a[b+TYPE]}}]),a}();exports.Route=Route;var _data=new WeakMap,_anyParentHasThisId=new WeakMap,_newGetter=new WeakMap,_defineMyAttributes=new WeakMap,_createChildRoute=new WeakMap,_diggestChildRoutes=new WeakMap,_as=new WeakMap;_defineProperty(Route,"DEFAULT_METHOD",GET),_defineProperty(Route,"diggest",function(a,b,c,d,e){if(!d||!e){var f={};return f[b+TYPE]=ROUTE,f[b+METHOD]=a[c+METHOD]||Route.DEFAULT_METHOD,Route.diggest(a,b,c,f,[ID,HIDE,JUST_ID,POSTFIX,PARENT_ID]),Route._trimSelector(c,a,f),f}e.forEach(function(e){d[b+e]=a[c+e]})}),_defineProperty(Route,"_trimSelector",function(a,b,c){Object.keys(b).forEach(function(d){d.slice(0,2)!==a?c[d]=b[d]:_throwWarning(Route,WARNING_ROUTE_ATTRIBUTE_NOT_SUPPORTED,d)})});var Alias=function(a){function b(){var a;_classCallCheck(this,b);for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return _possibleConstructorReturn(this,(a=_getPrototypeOf(b)).call.apply(a,[this].concat(d)))}return _inherits(b,a),_createClass(b,[{key:"path",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _get(_getPrototypeOf(b.prototype),"path",this).call(this,a,function(b){var c=s,d=_+":"+b[ID],e=b.parent||{};b.root;if(b[ID]&&a[JUST_ID])c+=d;else{var f=!!b[ID]&&a[b[ID]]!==!1;c+="Trocha"===e.constructor.name?s:_,c+=a[HIDE]?s:b[ALIAS],c+=f?d:s}return c})}}],[{key:"diggest",value:function(a,b,c){var d={};return d[b+TYPE]=_ALIAS,d[b+ALIAS]=a[c+ALIAS]||a,d[b+METHOD]=a[c+METHOD]||Route.DEFAULT_METHOD,Route.diggest(a,b,c,d,[ID,POSTFIX,PARENT_ID]),"string"!=typeof a&&Route._trimSelector(c,a,d),d}},{key:"is",value:function(a,b){return"string"==typeof a||a[b+TYPE]===_ALIAS&&a[b+ALIAS]}}]),b}(Route),Resource=function(a){function b(){var a;_classCallCheck(this,b);for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return _possibleConstructorReturn(this,(a=_getPrototypeOf(b)).call.apply(a,[this].concat(d)))}return _inherits(b,a),_createClass(b,[{key:"path",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;return _get(_getPrototypeOf(b.prototype),"path",this).call(this,a,function(a){return"function"==typeof c&&c()!==!0&&_throwWarning(void 0,WARNING_RESOURCE_AS_A_ROUTE),!1})}}],[{key:"diggest",value:function(a,b,c){var d={};return d[b+TYPE]=_RESOURCE,d[b+RESOURCE]=a[c+RESOURCE]||_basicResource(b),Route.diggest(a,b,c,d,[ID]),Route._trimSelector(c,a,d),d}},{key:"is",value:function(a,b){return a[b+TYPE]===_RESOURCE&&a[b+ID]}}]),b}(Route),Scope=function(a){function b(){var a;_classCallCheck(this,b);for(var c=arguments.length,d=new Array(c),e=0;e<c;e++)d[e]=arguments[e];return _possibleConstructorReturn(this,(a=_getPrototypeOf(b)).call.apply(a,[this].concat(d)))}return _inherits(b,a),_createClass(b,[{key:"path",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0;return _get(_getPrototypeOf(b.prototype),"path",this).call(this,a,function(a){return"function"==typeof c&&c()!==!0&&_throwError(void 0,ERROR_SCOPE_AS_A_ROUTE),!1})}}],[{key:"diggest",value:function(a,b,c){var d={};return d[b+TYPE]=SCOPE,d[b+JUST_ID]=!0,d[b+DEFAULT_ID]=a[c+DEFAULT_ID]||!1,Route.diggest(a,b,c,d,[ID,HIDE]),Route._trimSelector(c,a,d),d}},{key:"is",value:function(a,b){return"object"===_typeof(a)&&a[b+TYPE]===SCOPE&&a[b+ID]}}]),b}(Route),Trocha=function(a){function b(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,b),_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,null,null,a.customSelector,null,a.routes,a.domain,a.alwaysUrl,a.pre,a.post,a.alwaysPost))}return _inherits(b,a),_createClass(b,null,[{key:"ROUTE",get:function(){return ROUTE}},{key:"SCOPE",get:function(){return SCOPE}},{key:"RESOURCE",get:function(){return _RESOURCE}},{key:"ALIAS",get:function(){return _ALIAS}},{key:"OPTIONS",get:function(){return OPTIONS}},{key:"GET",get:function(){return GET}},{key:"HEAD",get:function(){return HEAD}},{key:"POST",get:function(){return POST}},{key:"PUT",get:function(){return PUT}},{key:"PATCH",get:function(){return PATCH}},{key:"DELETE",get:function(){return DELETE}},{key:"TRACE",get:function(){return TRACE}},{key:"CONNECT",get:function(){return CONNECT}},{key:"$RESOURCE",get:function(){return _basicResource()}}]),b}(Route);exports.Trocha=Trocha;